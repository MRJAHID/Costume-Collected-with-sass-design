'use strict';

function W(e){let i=new Set,n=!1,d=e,u,g=(a={})=>{u={...u,...a},h();},h=()=>{if(n)return;let a=!1;if(u){for(let m in u)if(d[m]!==u[m]){a=!0;break}}a&&(d={...d,...u},i.forEach(m=>m({state:d,updatedProperties:u})),u=void 0);};return {subscribe:a=>(i.add(a),()=>{i.delete(a);}),cleanup:()=>i.clear(),getState:()=>d,setState:g,batch:a=>{n=!0,a(),n=!1,h();}}}function X(e,i,n){return Math.max(i,Math.min(n,e))}function Y(e){e.preventDefault();}var Q=new Set(["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]);function V(e){if(Q.has(e.key))return Y(e),!1}var D;function R(){D=new AbortController;let{signal:e}=D;window.addEventListener("DOMMouseScroll",Y,{signal:e}),window.addEventListener("wheel",Y,{passive:!1,signal:e}),window.addEventListener("touchmove",Y,{passive:!1,signal:e}),window.addEventListener("keydown",V,{signal:e});}function T(){D?.abort();}function k(e){if(!e)throw new Error("Please specify a container for the zoom image");let i=e.querySelector("img");if(!i)throw new Error("Please place an image inside the container");return i}function _(e,i){return {x:(e.x+i.x)/2,y:(e.y+i.y)/2}}function P(e,i){return n=>{e()&&i(n);}}var z=.5;function ae(e,i={}){let n=W({currentZoom:1,enable:!0,currentPositionX:0,currentPositionY:0}),d=k(e),u={maxZoom:i.maxZoom||4,wheelZoomRatio:i.wheelZoomRatio||.1},g=(t,o)=>{let r=e.clientWidth;return t>0?0:t+r*o<r?-r*(o-1):t},h=(t,o)=>{let r=e.clientHeight;return t>0?0:t+r*o<r?-r*(o-1):t},a=-1,m=!0,Z="",l=new Map,y=!1,M=0,I=0,C=0,O=0;e.style.overflow="hidden",d.style.transformOrigin="0 0";function w(){let t=n.getState();d.style.transform=`translate(${t.currentPositionX}px, ${t.currentPositionY}px) scale(${t.currentZoom})`;}function U(t){n.batch(()=>{let o=n.getState();if(!(typeof t.enable=="boolean"&&t.enable!==o.enable&&(n.setState({enable:t.enable}),!t.enable))&&typeof t.currentZoom=="number"&&t.currentZoom!==o.currentZoom){let r=X(t.currentZoom,1,u.maxZoom);if(r===o.currentZoom)return;let p=e.clientWidth/2,c=e.clientHeight/2,f=(p-o.currentPositionX)/o.currentZoom,s=(c-o.currentPositionY)/o.currentZoom;n.setState({currentZoom:r,currentPositionX:g(-f*r+p,r),currentPositionY:h(-s*r+c,r)});}}),w();}function L({delta:t,x:o,y:r}){let p=e.getBoundingClientRect(),c=o-p.left,f=r-p.top,s=n.getState(),v=(c-s.currentPositionX)/s.currentZoom,E=(f-s.currentPositionY)/s.currentZoom,b=X(s.currentZoom+t*u.wheelZoomRatio*s.currentZoom,1,u.maxZoom);n.setState({currentZoom:b,currentPositionX:g(-v*b+c,b),currentPositionY:h(-E*b+f,b)});}function H(t){t.preventDefault();let o=-X(t.deltaY,-z,z);L({delta:o,x:t.clientX,y:t.clientY}),w();}function q(t){t.preventDefault();let{clientX:o,clientY:r,pointerId:p}=t;for(let[c]of l.entries())c===p&&l.set(c,{x:o,y:r});if(y){if(l.size===2&&Z==="pinch"){let c=l.values(),f=c.next().value,s=c.next().value,v=Math.sqrt(Math.pow(f.x-s.x,2)+Math.pow(f.y-s.y,2)),{x:E,y:b}=_(f,s);a>0&&(v>a&&L({delta:z,x:E,y:b}),v<a&&L({delta:-z,x:E,y:b})),a=v,w();return}if(l.size===1&&Z!=="pinch"){let c=o-C,f=r-O,{currentZoom:s}=n.getState();n.setState({currentPositionX:g(M+c,s),currentPositionY:h(I+f,s)}),w();}}}function F(t){if(t.preventDefault(),l.size===2)return;m&&(R(),m=!1);let{clientX:o,clientY:r,pointerId:p}=t;y=!0;let c=n.getState();M=c.currentPositionX,I=c.currentPositionY,C=o,O=r,l.set(p,{x:o,y:r}),l.size===2&&(Z="pinch");}function $(t){l.delete(t.pointerId),l.size===0&&(y=!1,a=-1),l.size===0&&!m&&(T(),m=!0),l.size===0&&Z==="pinch"&&(Z="");let o=n.getState();M=o.currentPositionX,I=o.currentPositionY;}function K(){l.clear(),y=!1,a=-1,m||(T(),m=!0);}function x(){return n.getState().enable}let B=P(x,H),j=P(x,F),G=P(x,K),J=P(x,q),N=P(x,$),A=new AbortController,{signal:S}=A;return e.addEventListener("wheel",B,{signal:S}),e.addEventListener("pointerdown",j,{signal:S}),e.addEventListener("pointerleave",G,{signal:S}),e.addEventListener("pointermove",J,{signal:S}),e.addEventListener("pointerup",N,{signal:S}),{cleanup(){A.abort(),n.cleanup();},subscribe:n.subscribe,setState:U,getState:n.getState}}

exports.createZoomImageWheel = ae;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=createZoomImageWheel.js.map