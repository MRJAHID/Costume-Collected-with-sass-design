{"version":3,"sources":["../src/store.ts","../../../node_modules/.pnpm/@namnode+store@0.1.0/node_modules/@namnode/store/dist/chunk-TZNK2OF3.mjs","../src/utils.ts","../src/createZoomImageMove.ts"],"names":["makeImageCache","loadedImageSet","checkImageLoaded","src","store","img","imageCache","f","o","r","s","a","e","i","n","preventDefault","event","keySet","preventDefaultForScrollKeys","controller","disableScroll","signal","enableScroll","getSourceImage","container","sourceImgElement","createZoomImageMove","options","finalOptions","zoomedImgWidth","zoomedImgHeight","zoomedImg","handlePointerEnter","processZoom","handlePointerMove","handlePointerLeave","calculatePositionX","newPositionX","width","calculatePositionY","newPositionY","height","containerRect","zoomPointX","zoomPointY","currentPositionX","currentPositionY"],"mappings":"AAEO,IAAMA,EAAiB,IAAM,CAClC,IAAMC,EAAiB,IAAI,IAErBC,EAAoBC,GAAgBF,EAAe,IAAIE,CAAG,EA2BhE,MAAO,CACL,gBA1BsB,CAAC,CACvB,IAAAA,EACA,MAAAC,EACA,IAAAC,CACF,IAIM,CACJA,EAAI,IAAMF,EACN,CAAAD,EAAiBC,CAAG,IAExBF,EAAe,IAAIE,CAAG,EAEtBC,EAAM,SAAS,CAAE,gBAAiB,SAAU,CAAC,EAE7CC,EAAI,iBAAiB,OAAQ,IAAM,CACjCD,EAAM,SAAS,CAAE,gBAAiB,QAAS,CAAC,CAC9C,CAAC,EAEDC,EAAI,iBAAiB,QAAS,IAAM,CAClCD,EAAM,SAAS,CAAE,gBAAiB,OAAQ,CAAC,CAC7C,CAAC,EACH,EAIE,iBAAAF,CACF,CACF,EAEaI,EAAaN,EAAe,ECtCzC,SAASO,EAAEC,EAAE,CAAC,IAAIC,EAAE,IAAI,IAAIC,EAAE,GAAGC,EAAEH,EAAEI,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAACA,EAAE,CAAC,GAAGA,EAAE,GAAG,CAAC,EAAEC,EAAE,CAAE,EAAEA,EAAE,IAAI,CAAC,GAAGH,EAAE,OAAO,IAAI,EAAE,GAAG,GAAGE,GAAG,QAAQE,KAAKF,EAAE,GAAGD,EAAEG,CAAC,IAAIF,EAAEE,CAAC,EAAE,CAAC,EAAE,GAAG,OAAO,IAAIH,EAAE,CAAC,GAAGA,EAAE,GAAGC,CAAC,EAAEH,EAAE,QAAQK,GAAGA,EAAE,CAAC,MAAMH,EAAE,kBAAkBC,CAAC,CAAC,CAAC,EAAEA,EAAE,OAAQ,EAAE,MAAO,CAAC,UAAU,IAAIH,EAAE,IAAI,CAAC,EAAE,IAAI,CAACA,EAAE,OAAO,CAAC,CAAE,GAAG,QAAQ,IAAIA,EAAE,MAAM,EAAE,SAAS,IAAIE,EAAE,SAAS,EAAE,MAAM,GAAG,CAACD,EAAE,GAAG,EAAE,EAAEA,EAAE,GAAGG,EAAE,CAAE,CAAC,CAAC,CCIjW,SAASE,EAAeC,EAAc,CACpCA,EAAM,eAAe,CACvB,CAEA,IAAMC,EAAS,IAAI,IAAI,CAAC,UAAW,aAAc,YAAa,WAAW,CAAC,EAC1E,SAASC,EAA4BF,EAAsB,CACzD,GAAIC,EAAO,IAAID,EAAM,GAAG,EACtB,OAAAD,EAAeC,CAAK,EACb,EAEX,CAEA,IAAIG,EAEG,SAASC,GAAgB,CAC9BD,EAAa,IAAI,gBACjB,GAAM,CAAE,OAAAE,CAAO,EAAIF,EACnB,OAAO,iBAAiB,iBAAkBJ,EAAgB,CAAE,OAAAM,CAAO,CAAC,EACpE,OAAO,iBAAiB,QAASN,EAAgB,CAAE,QAAS,GAAO,OAAAM,CAAO,CAAC,EAC3E,OAAO,iBAAiB,YAAaN,EAAgB,CAAE,QAAS,GAAO,OAAAM,CAAO,CAAC,EAC/E,OAAO,iBAAiB,UAAWH,EAA6B,CAAE,OAAAG,CAAO,CAAC,CAC5E,CAEO,SAASC,GAAe,CAC7BH,GAAY,MAAM,CACpB,CAEO,SAASI,EAAeC,EAAwB,CACrD,GAAI,CAACA,EACH,MAAM,IAAI,MAAM,+CAA+C,EAGjE,IAAMC,EAAmBD,EAAU,cAAc,KAAK,EACtD,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,4CAA4C,EAG9D,OAAOA,CACT,CC5BO,SAASC,EAAoBF,EAAwBG,EAAgC,CAAC,EAAG,CAC9F,IAAMF,EAAmBF,EAAeC,CAAS,EAC3CI,EAA+C,CACnD,WAAYD,EAAQ,YAAc,EAClC,gBAAiBA,EAAQ,iBAAmBF,EAAiB,GAC/D,EAEMrB,EAAQG,EAAgC,CAC5C,gBAAiBD,EAAW,iBAAiBsB,EAAa,eAAe,EAAI,SAAW,MAC1F,CAAC,EAEKC,EAAiBJ,EAAiB,YAAcG,EAAa,WAC7DE,EAAkBL,EAAiB,aAAeG,EAAa,WAC/DG,EAAYP,EAAU,YAAY,SAAS,cAAc,KAAK,CAAC,EACrEO,EAAU,MAAM,SAAW,OAC3BA,EAAU,MAAM,MAAQ,GAAGF,MAC3BE,EAAU,MAAM,OAAS,GAAGD,MAC5BC,EAAU,MAAM,SAAW,WAC3BA,EAAU,MAAM,IAAM,IACtBA,EAAU,MAAM,KAAO,IAEvB,SAASC,EAAmBhB,EAAqB,CAC/Ce,EAAU,MAAM,QAAU,QAC1BzB,EAAW,gBAAgB,CACzB,IAAKyB,EACL,IAAKH,EAAa,gBAClB,MAAAxB,CACF,CAAC,EAED6B,EAAYjB,CAAK,EACjBI,EAAc,CAChB,CAEA,SAASc,EAAkBlB,EAAqB,CAC9CiB,EAAYjB,CAAK,CACnB,CAEA,SAASmB,GAAqB,CAC5Bb,EAAa,EACbS,EAAU,MAAM,QAAU,OAC1BA,EAAU,MAAM,UAAY,MAC9B,CAEA,IAAMK,EAAsBC,GAAyB,CACnD,IAAMC,EAAQd,EAAU,YACxB,OAAIa,EAAe,EAAU,EACzBA,EAAeC,EAAQV,EAAa,WAAaU,EAAc,CAACA,GAASV,EAAa,WAAa,GAChGS,CACT,EAEME,EAAsBC,GAAyB,CACnD,IAAMC,EAASjB,EAAU,aACzB,OAAIgB,EAAe,EAAU,EACzBA,EAAeC,EAASb,EAAa,WAAaa,EAAe,CAACA,GAAUb,EAAa,WAAa,GACnGY,CACT,EAEA,SAASP,EAAYjB,EAAqB,CACxCe,EAAU,MAAM,QAAU,QAC1BzB,EAAW,gBAAgB,CACzB,IAAKyB,EACL,IAAKH,EAAa,gBAClB,MAAAxB,CACF,CAAC,EAED,IAAMsC,EAAgBlB,EAAU,sBAAsB,EAChDmB,EAAa3B,EAAM,QAAU0B,EAAc,KAC3CE,EAAa5B,EAAM,QAAU0B,EAAc,IAE3CG,EAAmBT,EAAmB,CAACO,EAAaf,EAAa,WAAae,CAAU,EACxFG,EAAmBP,EAAmB,CAACK,EAAahB,EAAa,WAAagB,CAAU,EAC9Fb,EAAU,MAAM,UAAY,aAAac,QAAuBC,MAClE,CAEA,IAAM3B,EAAa,IAAI,gBACjB,CAAE,OAAAE,CAAO,EAAIF,EACnB,OAAAK,EAAU,iBAAiB,eAAgBQ,EAAoB,CAAE,OAAAX,CAAO,CAAC,EACzEG,EAAU,iBAAiB,cAAeU,EAAmB,CAAE,OAAAb,CAAO,CAAC,EACvEG,EAAU,iBAAiB,eAAgBW,EAAoB,CAAE,OAAAd,CAAO,CAAC,EAElE,CACL,QAAS,IAAM,CACbF,EAAW,MAAM,EACjBK,EAAU,YAAYO,CAAS,EAC/B3B,EAAM,QAAQ,CAChB,EACA,UAAWA,EAAM,UACjB,SAAUA,EAAM,QAClB,CACF","sourcesContent":["import { createStore } from \"@namnode/store\"\n\nexport const makeImageCache = () => {\n  const loadedImageSet = new Set<string>()\n\n  const checkImageLoaded = (src: string) => loadedImageSet.has(src)\n\n  const createZoomImage = ({\n    src,\n    store,\n    img,\n  }: {\n    src: string\n    store: ReturnType<typeof createStore>\n    img: HTMLImageElement\n  }) => {\n    img.src = src\n    if (checkImageLoaded(src)) return\n\n    loadedImageSet.add(src)\n\n    store.setState({ zoomedImgStatus: \"loading\" })\n\n    img.addEventListener(\"load\", () => {\n      store.setState({ zoomedImgStatus: \"loaded\" })\n    })\n\n    img.addEventListener(\"error\", () => {\n      store.setState({ zoomedImgStatus: \"error\" })\n    })\n  }\n\n  return {\n    createZoomImage,\n    checkImageLoaded,\n  }\n}\n\nexport const imageCache = makeImageCache()\n","function f(o){let r=new Set,s=!1,a=o,e,c=(t={})=>{e={...e,...t},i();},i=()=>{if(s)return;let t=!1;if(e){for(let n in e)if(a[n]!==e[n]){t=!0;break}}t&&(a={...a,...e},r.forEach(n=>n({state:a,updatedProperties:e})),e=void 0);};return {subscribe:t=>(r.add(t),()=>{r.delete(t);}),cleanup:()=>r.clear(),getState:()=>a,setState:c,batch:t=>{s=!0,t(),s=!1,i();}}}\n\nexport { f as a };\n","export function clamp(value: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, value))\n}\n\nfunction preventDefault(event: Event) {\n  event.preventDefault()\n}\n\nconst keySet = new Set([\"ArrowUp\", \"ArrowRight\", \"ArrowDown\", \"ArrowLeft\"])\nfunction preventDefaultForScrollKeys(event: KeyboardEvent) {\n  if (keySet.has(event.key)) {\n    preventDefault(event)\n    return false\n  }\n}\n\nlet controller: AbortController | undefined\n\nexport function disableScroll() {\n  controller = new AbortController()\n  const { signal } = controller\n  window.addEventListener(\"DOMMouseScroll\", preventDefault, { signal })\n  window.addEventListener(\"wheel\", preventDefault, { passive: false, signal })\n  window.addEventListener(\"touchmove\", preventDefault, { passive: false, signal })\n  window.addEventListener(\"keydown\", preventDefaultForScrollKeys, { signal })\n}\n\nexport function enableScroll() {\n  controller?.abort()\n}\n\nexport function getSourceImage(container: HTMLElement) {\n  if (!container) {\n    throw new Error(\"Please specify a container for the zoom image\")\n  }\n\n  const sourceImgElement = container.querySelector(\"img\")\n  if (!sourceImgElement) {\n    throw new Error(\"Please place an image inside the container\")\n  }\n\n  return sourceImgElement\n}\n\nexport type PointerPosition = {\n  x: number\n  y: number\n}\n\nexport function getPointersCenter(first: PointerPosition, second: PointerPosition) {\n  return {\n    x: (first.x + second.x) / 2,\n    y: (first.y + second.y) / 2,\n  }\n}\n\nexport function makeMaybeCallFunction<T>(predicateFn: () => boolean, fn: (arg: T) => void) {\n  return (arg: T) => {\n    if (predicateFn()) {\n      fn(arg)\n    }\n  }\n}\n\nexport const scaleLinear =\n  ({\n    domainStart,\n    domainStop,\n    rangeStart,\n    rangeStop,\n  }: {\n    domainStart: number\n    domainStop: number\n    rangeStart: number\n    rangeStop: number\n  }) =>\n  (value: number) =>\n    rangeStart + (rangeStop - rangeStart) * ((value - domainStart) / (domainStop - domainStart))\n","import { imageCache } from \"./store\"\nimport { createStore } from \"@namnode/store\"\nimport { ZoomedImgStatus } from \"./types\"\nimport { disableScroll, enableScroll, getSourceImage } from \"./utils\"\n\nexport type ZoomImageMoveOptions = {\n  zoomFactor?: number\n  zoomImageSource?: string\n}\n\nexport type ZoomImageMoveState = {\n  zoomedImgStatus: ZoomedImgStatus\n}\n\nexport function createZoomImageMove(container: HTMLElement, options: ZoomImageMoveOptions = {}) {\n  const sourceImgElement = getSourceImage(container)\n  const finalOptions: Required<ZoomImageMoveOptions> = {\n    zoomFactor: options.zoomFactor ?? 4,\n    zoomImageSource: options.zoomImageSource ?? sourceImgElement.src,\n  }\n\n  const store = createStore<ZoomImageMoveState>({\n    zoomedImgStatus: imageCache.checkImageLoaded(finalOptions.zoomImageSource) ? \"loaded\" : \"idle\",\n  })\n\n  const zoomedImgWidth = sourceImgElement.clientWidth * finalOptions.zoomFactor\n  const zoomedImgHeight = sourceImgElement.clientHeight * finalOptions.zoomFactor\n  const zoomedImg = container.appendChild(document.createElement(\"img\"))\n  zoomedImg.style.maxWidth = \"none\"\n  zoomedImg.style.width = `${zoomedImgWidth}px`\n  zoomedImg.style.height = `${zoomedImgHeight}px`\n  zoomedImg.style.position = \"absolute\"\n  zoomedImg.style.top = \"0\"\n  zoomedImg.style.left = \"0\"\n\n  function handlePointerEnter(event: PointerEvent) {\n    zoomedImg.style.display = \"block\"\n    imageCache.createZoomImage({\n      img: zoomedImg,\n      src: finalOptions.zoomImageSource,\n      store,\n    })\n\n    processZoom(event)\n    disableScroll()\n  }\n\n  function handlePointerMove(event: PointerEvent) {\n    processZoom(event)\n  }\n\n  function handlePointerLeave() {\n    enableScroll()\n    zoomedImg.style.display = \"none\"\n    zoomedImg.style.transform = \"none\"\n  }\n\n  const calculatePositionX = (newPositionX: number) => {\n    const width = container.clientWidth\n    if (newPositionX > 0) return 0\n    if (newPositionX + width * finalOptions.zoomFactor < width) return -width * (finalOptions.zoomFactor - 1)\n    return newPositionX\n  }\n\n  const calculatePositionY = (newPositionY: number) => {\n    const height = container.clientHeight\n    if (newPositionY > 0) return 0\n    if (newPositionY + height * finalOptions.zoomFactor < height) return -height * (finalOptions.zoomFactor - 1)\n    return newPositionY\n  }\n\n  function processZoom(event: PointerEvent) {\n    zoomedImg.style.display = \"block\"\n    imageCache.createZoomImage({\n      img: zoomedImg,\n      src: finalOptions.zoomImageSource,\n      store,\n    })\n\n    const containerRect = container.getBoundingClientRect()\n    const zoomPointX = event.clientX - containerRect.left\n    const zoomPointY = event.clientY - containerRect.top\n\n    const currentPositionX = calculatePositionX(-zoomPointX * finalOptions.zoomFactor + zoomPointX)\n    const currentPositionY = calculatePositionY(-zoomPointY * finalOptions.zoomFactor + zoomPointY)\n    zoomedImg.style.transform = `translate(${currentPositionX}px, ${currentPositionY}px)`\n  }\n\n  const controller = new AbortController()\n  const { signal } = controller\n  container.addEventListener(\"pointerenter\", handlePointerEnter, { signal })\n  container.addEventListener(\"pointermove\", handlePointerMove, { signal })\n  container.addEventListener(\"pointerleave\", handlePointerLeave, { signal })\n\n  return {\n    cleanup: () => {\n      controller.abort()\n      container.removeChild(zoomedImg)\n      store.cleanup()\n    },\n    subscribe: store.subscribe,\n    getState: store.getState,\n  }\n}\n"]}