import { a } from './chunk-ZT5SJQQV.mjs';
import { d, f, a as a$1, b, c, e } from './chunk-2DUGZGRE.mjs';

var Y=.5;function Q(s,M={}){let r=a({currentZoom:1,enable:!0,currentPositionX:0,currentPositionY:0}),L=d(s),v={maxZoom:M.maxZoom||4,wheelZoomRatio:M.wheelZoomRatio||.1},y=(e,t)=>{let o=s.clientWidth;return e>0?0:e+o*t<o?-o*(t-1):e},X=(e,t)=>{let o=s.clientHeight;return e>0?0:e+o*t<o?-o*(t-1):e},m=-1,f$1=!0,h="",c$1=new Map,Z=!1,z=0,I=0,D=0,O=0;s.style.overflow="hidden",L.style.transformOrigin="0 0";function g(){let e=r.getState();L.style.transform=`translate(${e.currentPositionX}px, ${e.currentPositionY}px) scale(${e.currentZoom})`;}function U(e){r.batch(()=>{let t=r.getState();if(!(typeof e.enable=="boolean"&&e.enable!==t.enable&&(r.setState({enable:e.enable}),!e.enable))&&typeof e.currentZoom=="number"&&e.currentZoom!==t.currentZoom){let o=a$1(e.currentZoom,1,v.maxZoom);if(o===t.currentZoom)return;let l=s.clientWidth/2,n=s.clientHeight/2,a=(l-t.currentPositionX)/t.currentZoom,i=(n-t.currentPositionY)/t.currentZoom;r.setState({currentZoom:o,currentPositionX:y(-a*o+l,o),currentPositionY:X(-i*o+n,o)});}}),g();}function W({delta:e,x:t,y:o}){let l=s.getBoundingClientRect(),n=t-l.left,a=o-l.top,i=r.getState(),b=(n-i.currentPositionX)/i.currentZoom,S=(a-i.currentPositionY)/i.currentZoom,u=a$1(i.currentZoom+e*v.wheelZoomRatio*i.currentZoom,1,v.maxZoom);r.setState({currentZoom:u,currentPositionX:y(-b*u+n,u),currentPositionY:X(-S*u+a,u)});}function H(e){e.preventDefault();let t=-a$1(e.deltaY,-Y,Y);W({delta:t,x:e.clientX,y:e.clientY}),g();}function $(e$1){e$1.preventDefault();let{clientX:t,clientY:o,pointerId:l}=e$1;for(let[n]of c$1.entries())n===l&&c$1.set(n,{x:t,y:o});if(Z){if(c$1.size===2&&h==="pinch"){let n=c$1.values(),a=n.next().value,i=n.next().value,b=Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2)),{x:S,y:u}=e(a,i);m>0&&(b>m&&W({delta:Y,x:S,y:u}),b<m&&W({delta:-Y,x:S,y:u})),m=b,g();return}if(c$1.size===1&&h!=="pinch"){let n=t-D,a=o-O,{currentZoom:i}=r.getState();r.setState({currentPositionX:y(z+n,i),currentPositionY:X(I+a,i)}),g();}}}function k(e){if(e.preventDefault(),c$1.size===2)return;f$1&&(b(),f$1=!1);let{clientX:t,clientY:o,pointerId:l}=e;Z=!0;let n=r.getState();z=n.currentPositionX,I=n.currentPositionY,D=t,O=o,c$1.set(l,{x:t,y:o}),c$1.size===2&&(h="pinch");}function q(e){c$1.delete(e.pointerId),c$1.size===0&&(Z=!1,m=-1),c$1.size===0&&!f$1&&(c(),f$1=!0),c$1.size===0&&h==="pinch"&&(h="");let t=r.getState();z=t.currentPositionX,I=t.currentPositionY;}function A(){c$1.clear(),Z=!1,m=-1,f$1||(c(),f$1=!0);}function d$1(){return r.getState().enable}let B=f(d$1,H),F=f(d$1,k),j=f(d$1,A),G=f(d$1,$),J=f(d$1,q),w=new AbortController,{signal:P}=w;return s.addEventListener("wheel",B,{signal:P}),s.addEventListener("pointerdown",F,{signal:P}),s.addEventListener("pointerleave",j,{signal:P}),s.addEventListener("pointermove",G,{signal:P}),s.addEventListener("pointerup",J,{signal:P}),{cleanup(){w.abort(),r.cleanup();},subscribe:r.subscribe,setState:U,getState:r.getState}}

export { Q as a };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=chunk-4GXIRJUL.mjs.map