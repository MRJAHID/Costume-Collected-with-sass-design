{"version":3,"sources":["../src/store.ts","../../../node_modules/.pnpm/@namnode+store@0.1.0/node_modules/@namnode/store/dist/chunk-TZNK2OF3.mjs","../src/utils.ts","../src/createZoomImageHover.ts"],"names":["makeImageCache","loadedImageSet","checkImageLoaded","src","store","img","imageCache","f","o","s","e","c","t","i","clamp","value","min","max","preventDefault","event","keySet","preventDefaultForScrollKeys","controller","disableScroll","signal","enableScroll","getSourceImage","container","sourceImgElement","createZoomImageHover","options","zoomedImgWrapper","zoomedImg","zoomLens","finalOptions","scaleX","scaleY","offset","getOffset","element","elRect","getLimitX","getLimitY","zoomLensLeft","left","minX","zoomLensTop","top","minY","setZoomedImgSize","onSourceImageReady","setup","processZoom","handlePointerEnter","handlePointerLeave","handleScroll","offsetX","offsetY","backgroundTop","backgroundRight","newState"],"mappings":"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","sourcesContent":["import { createStore } from \"@namnode/store\"\n\nexport const makeImageCache = () => {\n  const loadedImageSet = new Set<string>()\n\n  const checkImageLoaded = (src: string) => loadedImageSet.has(src)\n\n  const createZoomImage = ({\n    src,\n    store,\n    img,\n  }: {\n    src: string\n    store: ReturnType<typeof createStore>\n    img: HTMLImageElement\n  }) => {\n    img.src = src\n    if (checkImageLoaded(src)) return\n\n    loadedImageSet.add(src)\n\n    store.setState({ zoomedImgStatus: \"loading\" })\n\n    img.addEventListener(\"load\", () => {\n      store.setState({ zoomedImgStatus: \"loaded\" })\n    })\n\n    img.addEventListener(\"error\", () => {\n      store.setState({ zoomedImgStatus: \"error\" })\n    })\n  }\n\n  return {\n    createZoomImage,\n    checkImageLoaded,\n  }\n}\n\nexport const imageCache = makeImageCache()\n","function f(o){let r=new Set,s=!1,a=o,e,c=(t={})=>{e={...e,...t},i();},i=()=>{if(s)return;let t=!1;if(e){for(let n in e)if(a[n]!==e[n]){t=!0;break}}t&&(a={...a,...e},r.forEach(n=>n({state:a,updatedProperties:e})),e=void 0);};return {subscribe:t=>(r.add(t),()=>{r.delete(t);}),cleanup:()=>r.clear(),getState:()=>a,setState:c,batch:t=>{s=!0,t(),s=!1,i();}}}\n\nexport { f as a };\n","export function clamp(value: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, value))\n}\n\nfunction preventDefault(event: Event) {\n  event.preventDefault()\n}\n\nconst keySet = new Set([\"ArrowUp\", \"ArrowRight\", \"ArrowDown\", \"ArrowLeft\"])\nfunction preventDefaultForScrollKeys(event: KeyboardEvent) {\n  if (keySet.has(event.key)) {\n    preventDefault(event)\n    return false\n  }\n}\n\nlet controller: AbortController | undefined\n\nexport function disableScroll() {\n  controller = new AbortController()\n  const { signal } = controller\n  window.addEventListener(\"DOMMouseScroll\", preventDefault, { signal })\n  window.addEventListener(\"wheel\", preventDefault, { passive: false, signal })\n  window.addEventListener(\"touchmove\", preventDefault, { passive: false, signal })\n  window.addEventListener(\"keydown\", preventDefaultForScrollKeys, { signal })\n}\n\nexport function enableScroll() {\n  controller?.abort()\n}\n\nexport function getSourceImage(container: HTMLElement) {\n  if (!container) {\n    throw new Error(\"Please specify a container for the zoom image\")\n  }\n\n  const sourceImgElement = container.querySelector(\"img\")\n  if (!sourceImgElement) {\n    throw new Error(\"Please place an image inside the container\")\n  }\n\n  return sourceImgElement\n}\n\nexport type PointerPosition = {\n  x: number\n  y: number\n}\n\nexport function getPointersCenter(first: PointerPosition, second: PointerPosition) {\n  return {\n    x: (first.x + second.x) / 2,\n    y: (first.y + second.y) / 2,\n  }\n}\n\nexport function makeMaybeCallFunction<T>(predicateFn: () => boolean, fn: (arg: T) => void) {\n  return (arg: T) => {\n    if (predicateFn()) {\n      fn(arg)\n    }\n  }\n}\n\nexport const scaleLinear =\n  ({\n    domainStart,\n    domainStop,\n    rangeStart,\n    rangeStop,\n  }: {\n    domainStart: number\n    domainStop: number\n    rangeStart: number\n    rangeStop: number\n  }) =>\n  (value: number) =>\n    rangeStart + (rangeStop - rangeStart) * ((value - domainStart) / (domainStop - domainStart))\n","import { imageCache } from \"./store\"\nimport { createStore } from \"@namnode/store\"\nimport { ZoomedImgStatus } from \"./types\"\nimport { enableScroll, disableScroll, clamp, getSourceImage } from \"./utils\"\n\nexport type ZoomImageHoverOptions = {\n  customZoom?: { width: number; height: number }\n  zoomImageSource?: string\n  zoomLensClass?: string\n  zoomTarget?: HTMLElement\n  scaleFactor?: number\n}\n\nexport type ZoomImageHoverState = {\n  zoomedImgStatus: ZoomedImgStatus\n  enabled: boolean\n}\n\nexport type ZoomImageHoverStateUpdate = { enabled: boolean }\n\ntype RequiredExcept<T, K extends keyof T> = Omit<Required<T>, K> & {\n  [P in K]?: T[P]\n}\n\nexport function createZoomImageHover(container: HTMLElement, options: ZoomImageHoverOptions = {}) {\n  const controller = new AbortController()\n  const { signal } = controller\n  const sourceImgElement = getSourceImage(container)\n  const zoomedImgWrapper = document.createElement(\"div\")\n  zoomedImgWrapper.style.overflow = \"hidden\"\n  const zoomedImg = zoomedImgWrapper.appendChild(document.createElement(\"img\"))\n  zoomedImg.style.maxWidth = \"none\"\n  const zoomLens = container.appendChild(document.createElement(\"div\"))\n\n  const finalOptions: RequiredExcept<ZoomImageHoverOptions, \"zoomTarget\" | \"customZoom\"> = {\n    zoomImageSource: options.zoomImageSource || sourceImgElement.src,\n    zoomLensClass: options.zoomLensClass || \"\",\n    customZoom: options.customZoom,\n    scaleFactor: options.scaleFactor || 1,\n    zoomTarget: options.zoomTarget,\n  }\n\n  const store = createStore<ZoomImageHoverState>({\n    zoomedImgStatus: imageCache.checkImageLoaded(finalOptions.zoomImageSource) ? \"loaded\" : \"idle\",\n    enabled: true,\n  })\n\n  let scaleX: number\n  let scaleY: number\n  let offset: { left: number; top: number }\n\n  function getOffset(element: HTMLElement) {\n    const elRect = element.getBoundingClientRect()\n    return { left: elRect.left, top: elRect.top }\n  }\n\n  function getLimitX(value: number) {\n    return sourceImgElement.width - value\n  }\n\n  function getLimitY(value: number) {\n    return sourceImgElement.height - value\n  }\n\n  function zoomLensLeft(left: number) {\n    const minX = zoomLens.clientWidth / 2\n    return clamp(left, minX, getLimitX(minX)) - minX\n  }\n\n  function zoomLensTop(top: number) {\n    const minY = zoomLens.clientHeight / 2\n    return clamp(top, minY, getLimitY(minY)) - minY\n  }\n\n  function setZoomedImgSize() {\n    // Custom zoom available\n    if (finalOptions.customZoom) {\n      zoomedImgWrapper.style.width = finalOptions.customZoom.width + \"px\"\n      zoomedImgWrapper.style.height = finalOptions.customZoom.height + \"px\"\n      return\n    }\n\n    // Default zoom to source image size\n    zoomedImgWrapper.style.width = sourceImgElement.width + \"px\"\n    zoomedImgWrapper.style.height = sourceImgElement.height + \"px\"\n  }\n\n  function onSourceImageReady() {\n    setZoomedImgSize()\n    offset = getOffset(sourceImgElement)\n    // Calculate scale and offset\n    scaleX = sourceImgElement.naturalWidth / sourceImgElement.width\n    scaleY = sourceImgElement.naturalHeight / sourceImgElement.height\n\n    zoomedImg.style.display = \"block\"\n    zoomedImg.style.display = \"none\"\n\n    // Setup default zoom lens style\n    zoomLens.style.position = \"absolute\"\n\n    if (!finalOptions.zoomLensClass) {\n      zoomLens.style.background = \"rgba(238, 130, 238, 0.5)\"\n    }\n\n    if (finalOptions.customZoom) {\n      zoomLens.style.width = (finalOptions.customZoom.width / scaleX) * finalOptions.scaleFactor + \"px\"\n      zoomLens.style.height = (finalOptions.customZoom.height / scaleY) * finalOptions.scaleFactor + \"px\"\n      return\n    }\n\n    zoomLens.style.width = sourceImgElement.clientWidth / scaleX + \"px\"\n    zoomLens.style.height = sourceImgElement.clientHeight / scaleY + \"px\"\n  }\n\n  function setup() {\n    zoomLens.style.display = \"none\"\n\n    if (finalOptions.zoomLensClass) {\n      zoomLens.classList.add(finalOptions.zoomLensClass)\n    }\n\n    // setup event listeners\n    container.addEventListener(\"pointerdown\", processZoom, { signal })\n    container.addEventListener(\"pointermove\", processZoom, { signal })\n    container.addEventListener(\"pointerenter\", handlePointerEnter, { signal })\n    container.addEventListener(\"pointerleave\", handlePointerLeave, { signal })\n    window.addEventListener(\"scroll\", handleScroll, { signal })\n\n    // Setup zoomed image position if zoom target is specified\n    if (finalOptions.zoomTarget) {\n      finalOptions.zoomTarget.appendChild(zoomedImgWrapper)\n      return\n    }\n\n    container.appendChild(zoomedImgWrapper)\n    zoomedImg.style.position = \"absolute\"\n    zoomedImg.style.top = \"0px\"\n    zoomedImg.style.right = \"0px\"\n    zoomedImg.style.transform = \"translateX(100%)\"\n  }\n\n  function processZoom(event: PointerEvent) {\n    let offsetX: number\n    let offsetY: number\n    let backgroundTop: number\n    let backgroundRight: number\n    // let backgroundPosition: string\n    if (offset) {\n      offsetX = zoomLensLeft(event.clientX - offset.left)\n      offsetY = zoomLensTop(event.clientY - offset.top)\n      backgroundTop = (offsetX * scaleX) / finalOptions.scaleFactor\n      backgroundRight = (offsetY * scaleY) / finalOptions.scaleFactor\n      zoomedImg.style.transform = \"translate(\" + -backgroundTop + \"px,\" + -backgroundRight + \"px)\"\n      zoomLens.style.cssText += \"transform:\" + \"translate(\" + offsetX + \"px,\" + offsetY + \"px); top: 0; left: 0;\"\n    }\n  }\n\n  async function handlePointerEnter() {\n    imageCache.createZoomImage({\n      img: zoomedImg,\n      src: finalOptions.zoomImageSource,\n      store,\n    })\n\n    disableScroll()\n    zoomedImg.style.display = \"block\"\n    zoomLens.style.display = \"block\"\n  }\n\n  function handlePointerLeave() {\n    enableScroll()\n    zoomedImg.style.display = \"none\"\n    zoomLens.style.display = \"none\"\n  }\n\n  function handleScroll() {\n    offset = getOffset(sourceImgElement)\n  }\n\n  if (sourceImgElement.complete) {\n    onSourceImageReady()\n  } else {\n    sourceImgElement.onload = onSourceImageReady\n  }\n\n  setup()\n\n  return {\n    cleanup: () => {\n      controller.abort()\n      container.removeChild(zoomLens)\n\n      if (finalOptions.zoomTarget) {\n        finalOptions.zoomTarget.removeChild(zoomedImgWrapper)\n        return\n      }\n\n      container.removeChild(zoomedImgWrapper)\n    },\n    subscribe: store.subscribe,\n    getState: store.getState,\n    setState: (newState: ZoomImageHoverStateUpdate) => {\n      store.setState(newState)\n    },\n  }\n}\n"]}