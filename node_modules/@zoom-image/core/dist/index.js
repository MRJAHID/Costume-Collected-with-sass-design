'use strict';

var ee=()=>{let e=new Set,m=n=>e.has(n);return {createZoomImage:({src:n,store:o,img:c})=>{c.src=n,!m(n)&&(e.add(n),o.setState({zoomedImgStatus:"loading"}),c.addEventListener("load",()=>{o.setState({zoomedImgStatus:"loaded"});}),c.addEventListener("error",()=>{o.setState({zoomedImgStatus:"error"});}));},checkImageLoaded:m}},C=ee();function M(e){let m=new Set,a=!1,n=e,o,c=(t={})=>{o={...o,...t},l();},l=()=>{if(a)return;let t=!1;if(o){for(let r in o)if(n[r]!==o[r]){t=!0;break}}t&&(n={...n,...o},m.forEach(r=>r({state:n,updatedProperties:o})),o=void 0);};return {subscribe:t=>(m.add(t),()=>{m.delete(t);}),cleanup:()=>m.clear(),getState:()=>n,setState:c,batch:t=>{a=!0,t(),a=!1,l();}}}function O(e,m,a){return Math.max(m,Math.min(a,e))}function K(e){e.preventDefault();}var te=new Set(["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]);function oe(e){if(te.has(e.key))return K(e),!1}var N;function T(){N=new AbortController;let{signal:e}=N;window.addEventListener("DOMMouseScroll",K,{signal:e}),window.addEventListener("wheel",K,{passive:!1,signal:e}),window.addEventListener("touchmove",K,{passive:!1,signal:e}),window.addEventListener("keydown",oe,{signal:e});}function k(){N?.abort();}function F(e){if(!e)throw new Error("Please specify a container for the zoom image");let m=e.querySelector("img");if(!m)throw new Error("Please place an image inside the container");return m}function V(e,m){return {x:(e.x+m.x)/2,y:(e.y+m.y)/2}}function R(e,m){return a=>{e()&&m(a);}}var B=({domainStart:e,domainStop:m,rangeStart:a,rangeStop:n})=>o=>a+(n-a)*((o-e)/(m-e));function ne(e,m={}){let a=new AbortController,{signal:n}=a,o=F(e),c=document.createElement("div");c.style.overflow="hidden";let l=c.appendChild(document.createElement("img"));l.style.maxWidth="none";let t=e.appendChild(document.createElement("div")),r={zoomImageSource:m.zoomImageSource||o.src,zoomLensClass:m.zoomLensClass||"",customZoom:m.customZoom,scaleFactor:m.scaleFactor||1,zoomTarget:m.zoomTarget},f=M({zoomedImgStatus:C.checkImageLoaded(r.zoomImageSource)?"loaded":"idle",enabled:!0}),p,Z,y;function v(h){let b=h.getBoundingClientRect();return {left:b.left,top:b.top}}function P(h){return o.width-h}function x(h){return o.height-h}function i(h){let b=t.clientWidth/2;return O(h,b,P(b))-b}function d(h){let b=t.clientHeight/2;return O(h,b,x(b))-b}function z(){if(r.customZoom){c.style.width=r.customZoom.width+"px",c.style.height=r.customZoom.height+"px";return}c.style.width=o.width+"px",c.style.height=o.height+"px";}function E(){if(z(),y=v(o),p=o.naturalWidth/o.width,Z=o.naturalHeight/o.height,l.style.display="block",l.style.display="none",t.style.position="absolute",r.zoomLensClass||(t.style.background="rgba(238, 130, 238, 0.5)"),r.customZoom){t.style.width=r.customZoom.width/p*r.scaleFactor+"px",t.style.height=r.customZoom.height/Z*r.scaleFactor+"px";return}t.style.width=o.clientWidth/p+"px",t.style.height=o.clientHeight/Z+"px";}function X(){if(t.style.display="none",r.zoomLensClass&&t.classList.add(r.zoomLensClass),e.addEventListener("pointerdown",W,{signal:n}),e.addEventListener("pointermove",W,{signal:n}),e.addEventListener("pointerenter",G,{signal:n}),e.addEventListener("pointerleave",J,{signal:n}),window.addEventListener("scroll",Y,{signal:n}),r.zoomTarget){r.zoomTarget.appendChild(c);return}e.appendChild(c),l.style.position="absolute",l.style.top="0px",l.style.right="0px",l.style.transform="translateX(100%)";}function W(h){let b,D,U,q;y&&(b=i(h.clientX-y.left),D=d(h.clientY-y.top),U=b*p/r.scaleFactor,q=D*Z/r.scaleFactor,l.style.transform="translate("+-U+"px,"+-q+"px)",t.style.cssText+="transform:translate("+b+"px,"+D+"px); top: 0; left: 0;");}async function G(){C.createZoomImage({img:l,src:r.zoomImageSource,store:f}),T(),l.style.display="block",t.style.display="block";}function J(){k(),l.style.display="none",t.style.display="none";}function Y(){y=v(o);}return o.complete?E():o.onload=E,X(),{cleanup:()=>{if(a.abort(),e.removeChild(t),r.zoomTarget){r.zoomTarget.removeChild(c);return}e.removeChild(c);},subscribe:f.subscribe,getState:f.getState,setState:h=>{f.setState(h);}}}function re(e,m={}){let a=F(e),n={zoomFactor:m.zoomFactor??4,zoomImageSource:m.zoomImageSource??a.src},o=M({zoomedImgStatus:C.checkImageLoaded(n.zoomImageSource)?"loaded":"idle"}),c=a.clientWidth*n.zoomFactor,l=a.clientHeight*n.zoomFactor,t=e.appendChild(document.createElement("img"));t.style.maxWidth="none",t.style.width=`${c}px`,t.style.height=`${l}px`,t.style.position="absolute",t.style.top="0",t.style.left="0";function r(i){t.style.display="block",C.createZoomImage({img:t,src:n.zoomImageSource,store:o}),v(i),T();}function f(i){v(i);}function p(){k(),t.style.display="none",t.style.transform="none";}let Z=i=>{let d=e.clientWidth;return i>0?0:i+d*n.zoomFactor<d?-d*(n.zoomFactor-1):i},y=i=>{let d=e.clientHeight;return i>0?0:i+d*n.zoomFactor<d?-d*(n.zoomFactor-1):i};function v(i){t.style.display="block",C.createZoomImage({img:t,src:n.zoomImageSource,store:o});let d=e.getBoundingClientRect(),z=i.clientX-d.left,E=i.clientY-d.top,X=Z(-z*n.zoomFactor+z),W=y(-E*n.zoomFactor+E);t.style.transform=`translate(${X}px, ${W}px)`;}let P=new AbortController,{signal:x}=P;return e.addEventListener("pointerenter",r,{signal:x}),e.addEventListener("pointermove",f,{signal:x}),e.addEventListener("pointerleave",p,{signal:x}),{cleanup:()=>{P.abort(),e.removeChild(t),o.cleanup();},subscribe:o.subscribe,getState:o.getState}}var j=.5;function ae(e,m={}){let a=M({currentZoom:1,enable:!0,currentPositionX:0,currentPositionY:0}),n=F(e),o={maxZoom:m.maxZoom||4,wheelZoomRatio:m.wheelZoomRatio||.1},c=(s,u)=>{let g=e.clientWidth;return s>0?0:s+g*u<g?-g*(u-1):s},l=(s,u)=>{let g=e.clientHeight;return s>0?0:s+g*u<g?-g*(u-1):s},t=-1,r=!0,f="",p=new Map,Z=!1,y=0,v=0,P=0,x=0;e.style.overflow="hidden",n.style.transformOrigin="0 0";function i(){let s=a.getState();n.style.transform=`translate(${s.currentPositionX}px, ${s.currentPositionY}px) scale(${s.currentZoom})`;}function d(s){a.batch(()=>{let u=a.getState();if(!(typeof s.enable=="boolean"&&s.enable!==u.enable&&(a.setState({enable:s.enable}),!s.enable))&&typeof s.currentZoom=="number"&&s.currentZoom!==u.currentZoom){let g=O(s.currentZoom,1,o.maxZoom);if(g===u.currentZoom)return;let w=e.clientWidth/2,I=e.clientHeight/2,L=(w-u.currentPositionX)/u.currentZoom,S=(I-u.currentPositionY)/u.currentZoom;a.setState({currentZoom:g,currentPositionX:c(-L*g+w,g),currentPositionY:l(-S*g+I,g)});}}),i();}function z({delta:s,x:u,y:g}){let w=e.getBoundingClientRect(),I=u-w.left,L=g-w.top,S=a.getState(),$=(I-S.currentPositionX)/S.currentZoom,_=(L-S.currentPositionY)/S.currentZoom,H=O(S.currentZoom+s*o.wheelZoomRatio*S.currentZoom,1,o.maxZoom);a.setState({currentZoom:H,currentPositionX:c(-$*H+I,H),currentPositionY:l(-_*H+L,H)});}function E(s){s.preventDefault();let u=-O(s.deltaY,-j,j);z({delta:u,x:s.clientX,y:s.clientY}),i();}function X(s){s.preventDefault();let{clientX:u,clientY:g,pointerId:w}=s;for(let[I]of p.entries())I===w&&p.set(I,{x:u,y:g});if(Z){if(p.size===2&&f==="pinch"){let I=p.values(),L=I.next().value,S=I.next().value,$=Math.sqrt(Math.pow(L.x-S.x,2)+Math.pow(L.y-S.y,2)),{x:_,y:H}=V(L,S);t>0&&($>t&&z({delta:j,x:_,y:H}),$<t&&z({delta:-j,x:_,y:H})),t=$,i();return}if(p.size===1&&f!=="pinch"){let I=u-P,L=g-x,{currentZoom:S}=a.getState();a.setState({currentPositionX:c(y+I,S),currentPositionY:l(v+L,S)}),i();}}}function W(s){if(s.preventDefault(),p.size===2)return;r&&(T(),r=!1);let{clientX:u,clientY:g,pointerId:w}=s;Z=!0;let I=a.getState();y=I.currentPositionX,v=I.currentPositionY,P=u,x=g,p.set(w,{x:u,y:g}),p.size===2&&(f="pinch");}function G(s){p.delete(s.pointerId),p.size===0&&(Z=!1,t=-1),p.size===0&&!r&&(k(),r=!0),p.size===0&&f==="pinch"&&(f="");let u=a.getState();y=u.currentPositionX,v=u.currentPositionY;}function J(){p.clear(),Z=!1,t=-1,r||(k(),r=!0);}function Y(){return a.getState().enable}let h=R(Y,E),b=R(Y,W),D=R(Y,J),U=R(Y,X),q=R(Y,G),Q=new AbortController,{signal:A}=Q;return e.addEventListener("wheel",h,{signal:A}),e.addEventListener("pointerdown",b,{signal:A}),e.addEventListener("pointerleave",D,{signal:A}),e.addEventListener("pointermove",U,{signal:A}),e.addEventListener("pointerup",q,{signal:A}),{cleanup(){Q.abort(),a.cleanup();},subscribe:a.subscribe,setState:d,getState:a.getState}}function me(e,m={}){let a=F(e),n={zoomFactor:m.zoomFactor??4,zoomImageSource:m.zoomImageSource??a.src},o=!1,c=M({zoomedImgStatus:C.checkImageLoaded(n.zoomImageSource)?"loaded":"idle"}),l=a.clientWidth*n.zoomFactor,t=a.clientHeight*n.zoomFactor,r=e.appendChild(document.createElement("img"));r.style.maxWidth="none",r.style.width=`${l}px`,r.style.height=`${t}px`,r.style.position="absolute",r.style.top="0",r.style.left="0";function f(i){o&&y(i);}let p=i=>{let d=e.clientWidth;return i>0?0:i+d*n.zoomFactor<d?-d*(n.zoomFactor-1):i},Z=i=>{let d=e.clientHeight;return i>0?0:i+d*n.zoomFactor<d?-d*(n.zoomFactor-1):i};function y(i){r.style.display="block",C.createZoomImage({img:r,src:n.zoomImageSource,store:c});let d=e.getBoundingClientRect(),z=i.clientX-d.left,E=i.clientY-d.top,X=p(-z*n.zoomFactor+z),W=Z(-E*n.zoomFactor+E);r.style.transform=`translate(${X}px, ${W}px)`;}function v(i){if(o){o=!1,r.style.display="none";return}y(i),o=!0;}let P=new AbortController,{signal:x}=P;return e.addEventListener("pointerdown",v,{signal:x}),e.addEventListener("pointerenter",T,{signal:x}),e.addEventListener("pointerleave",k,{signal:x}),e.addEventListener("pointermove",f,{signal:x}),{cleanup:()=>{P.abort(),e.removeChild(r),c.cleanup();},subscribe:c.subscribe,getState:c.getState}}var ie=e=>B({domainStart:1,domainStop:e,rangeStart:0,rangeStop:100});var se=e=>B({domainStart:0,domainStop:100,rangeStart:1,rangeStop:e});var ce=({image:e,positionX:m,positionY:a,currentZoom:n})=>{let o=document.createElement("canvas"),c=e.naturalWidth/(e.clientWidth*n),l=e.clientWidth*c,t=e.clientHeight*c;o.width=l,o.height=t;let r=o.getContext("2d"),f=Math.max(0,Math.abs(m)*c),p=Math.max(0,Math.abs(a)*c);return r.drawImage(e,f,p,l,t,0,0,l,t),o.toDataURL()};

exports.createZoomImageClick = me;
exports.createZoomImageHover = ne;
exports.createZoomImageMove = re;
exports.createZoomImageWheel = ae;
exports.cropImage = ce;
exports.makeCalculatePercentage = ie;
exports.makeCalculateZoom = se;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map